<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:ia="http://java.sun.com/jsf/composite/components/intact"

                template="/main_template.xhtml">

    <ui:define name="topNavigation">
        <ui:include src="/shared/top_navigation_bar.xhtml">
            <ui:param name="selected" value="curate"/>
        </ui:include>
    </ui:define>

    <ui:define name="topTitle">
        <h:panelGroup rendered="#{publicationController.publication != null}">
            <h:link outcome="/curate/publication" value="#{publicationController.firstAuthor} et al (#{publicationController.year})" rendered="#{publicationController.firstAuthor != null}"/>

            <h:panelGroup rendered="#{publicationController.publication.shortLabel != null}">
                (&#160;<h:outputText value="#{publicationController.publication.shortLabel}"/> )
            </h:panelGroup>
        </h:panelGroup>
    </ui:define>

    <ui:define name="top">
        <h:panelGroup rendered="#{annotatedObjectController.annotatedObject != null}">
            <h:panelGroup id="topSavePanel" style="float: right">
                <p:commandButton type="button" id="topSaveButton" value="Save" onclick="save(); return false" />
                <!--<p:commandButton value="save 2" actionListener="#{annotatedObjectController.doSave}" ajax="false" />-->

                <h:panelGroup rendered="#{annotatedObjectController.lastSaved != null}" style="color: #AAAAAA">
                    <h:outputText value=" Last Saved: " />
                    <h:outputText value="#{annotatedObjectController.lastSaved}">
                        <f:convertDateTime pattern="HH:mm (z)"/>
                    </h:outputText>
                </h:panelGroup>
            </h:panelGroup>
        </h:panelGroup>
    </ui:define>

    <ui:define name="menuBar">
        <p:menubar>
            <ui:insert name="menuBarContextual"/>
            <p:submenu label="Main">
                <p:submenu>
                <f:facet name="label">
                    <p:menuitem value="New" icon="/resources/images/new.png"/>
                </f:facet>
                <p:menuitem value="Publication" onclick="newPublicationDlg.show();" helpText="ALT+N"/>
                <!--<p:menuitem value="CV Object" action="#{cvObjectController.newCvObject}"/>-->
                <p:menuitem value="Organism" action="#{bioSourceController.newOrganism}" ajax="false"/>
            </p:submenu>
                <!--<p:menuitem value="New" onclick="newPublicationDlg.show();"/>-->
                <p:menuitem value="Open by PMID" onclick="openByPmidDlg.show(); " helpText="ALT+O" icon="/resources/images/open.png"/>
                <p:menuitem value="Save" oncomplete="save()" helpText="ALT+S" icon="/resources/images/save.gif"
                        rendered="#{annotatedObjectController.annotatedObject != null}"/>
                <p:menuitem value="Save &amp; Close" onclick="save()" ajax="false"
                            rendered="#{annotatedObjectController.annotatedObject != null}"/>
            </p:submenu>
            <!--<p:submenu label="Experiments" rendered="#{publicationController.publication != null}"/>-->
            <!--<p:submenu label="Interactions" rendered="#{publicationController.publication != null}"/>-->
        </p:menubar>
    </ui:define>

    <ui:define name="content">
        <p:hotkey bind="alt+n" oncomplete="newPublicationDlg.show()"/>
        <p:hotkey bind="alt+o" oncomplete="openByPmidDlg.show()"/>
        <p:hotkey bind="alt+s" oncomplete="save(); return false"/>

        
        <br />
        <p>&#160;</p>

        <p:messages id="messagesComponent" showDetail="true"/>

        <div style="width:100%;">
            <ui:insert name="curateContent"/>

            <p:outputPanel id="changesPanel">
            <h:panelGroup rendered="#{annotatedObjectController.unsavedChanges}">

            <p>&#160;</p>

            <div class="intact-notSavedPanel">
                    Changes not yet saved &#160;
                <p:commandButton type="button" id="unsavedSaveButton" value="Save" onclick="save(); return false"/>
                &#160;-&#160;
                <p:commandLink id="unsavedRevertLink" value="Revert"
                               actionListener="#{annotatedObjectController.doRevertChanges}"
                               update="editorForm,growl,messagesComponent"
                               onclick="revertDialog.show()" oncomplete="revertDialog.hide()"/>
            </div>

            </h:panelGroup>
        </p:outputPanel>
        </div>

        <p:remoteCommand name="save" actionListener="#{annotatedObjectController.doSave}"
                        update="editorForm,growl,messagesComponent" onstart="saveDialog.show(); var input = document.getElementById('topSaveButton'); input.disabled = true; input.value = 'Saving...'"
                        onerror="alert('Error: '+error+' '+status)"
                        oncomplete="saveDialog.hide(); var input = document.getElementById('topSaveButton'); input.disabled = false; input.value = 'Save'"/>
        

    </ui:define>

    <ui:define name="dialogs">
        <ui:include src="menu_dialogs.xhtml"/>

        <ia:loadingDialog widgetVar="saveDialog" message="Saving #{annotatedObjectController.annotatedObject.class.simpleName}..."/>
        <ia:loadingDialog widgetVar="revertDialog" message="Reverting changes..."/>
    </ui:define>

</ui:composition>