<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:ia="http://java.sun.com/jsf/composite/components/intact">

    <h:panelGroup id="participantsTable">

        <p:dataTable var="wrapper" value="#{value}"
                     rows="15" paginatorAlwaysVisible="false" paginator="true" paginatorPosition="both"
                     rowStyleClass="#{wrapper.participant.ac == null? 'intact-new' : wrapper.deleted? 'intact-deleted' : null}">

            <ui:param name="participant" value="#{wrapper.participant}" />
            <ui:param name="interactor" value="#{participant.interactor}" />

            <!--<p:column expansion="true" />-->

            <p:column>
                <f:facet name="header"><h:outputText value="Name"/></f:facet>
                <p:commandLink onclick="load_participant.show()" action="#{curateController.edit(participant)}"
                               value="#{interactor.shortLabel}" rendered="#{interactor != null}"
                               ajax="false"/>

                <h:panelGroup rendered="#{interactor == null}">
                    <p:commandLink onclick="load_participant.show()" action="#{curateController.edit(participant)}"
                                   value="(no interactor)" rendered="#{interactor == null}"
                                   style="font-style: italic;"
                                   ajax="false"/>

                                    <span class="ui-icon ui-icon-alert" style="display:inline-block"
                                          title="No interactor for this participant"/>
                </h:panelGroup>
            </p:column>

            <p:column>
                <f:facet name="header"><h:outputText value="Identity"/></f:facet>
                <h:outputText value="#{interactionController.getInteractorIdentity(participant.interactor)}" />
            </p:column>

            <p:column>
                <f:facet name="header"><h:outputText value="Expressed in"/></f:facet>
                <h:selectOneMenu id="expressedInTxt" value="#{wrapper.participant.expressedIn}" onchange="markAsUnsaved()">
                    <f:selectItems value="#{bioSourceService.bioSourceSelectItems}" />
                </h:selectOneMenu>
            </p:column>

            <p:column>
                <f:facet name="header"><h:outputText value="Experimental role"/></f:facet>
                <h:selectOneMenu id="expRoleTxt" value="#{wrapper.participant.cvExperimentalRole}" onchange="markAsUnsaved()">
                        <f:selectItems value="#{cvObjectService.experimentalRoleSelectItems}" />
                    <f:ajax execute="@this" event="valueChange"
                            listener="#{interactionController.updateShortLabel()}" render=":editorForm:shortlabelTxt"/>
                </h:selectOneMenu>
            </p:column>

             <p:column>
                <f:facet name="header"><h:outputText value="Biological role"/></f:facet>
                <h:selectOneMenu id="bioRoleTxt" value="#{wrapper.participant.cvBiologicalRole}" onchange="markAsUnsaved()">
                        <f:selectItems value="#{cvObjectService.biologicalRoleSelectItems}" />
                </h:selectOneMenu>
            </p:column>

            <p:column>
                <f:facet name="header"><h:outputText value="# Feat."/></f:facet>
                <h:outputText value="#{participant.bindingDomains.size()}" />
            </p:column>

             <p:column>
                <f:facet name="header"><h:outputText value="Stoich."/></f:facet>
                <p:spinner id="stoichiometryTxt" value="#{participant.stoichiometry}" stepFactor="1" size="3" maxlength="2" onchange="markAsUnsaved()"/>
            </p:column>

            <p:column>
                <f:facet name="header"><h:outputText value="Options"/></f:facet>
                <p:menuButton value="Options">
                    <p:menuitem value="Edit" action="#{curateController.edit(participant)}"
                                onclick="load_participant.show()" oncomplete="load_participant.hide()"
                                ajax="false"/>
                    <p:menuitem value="Duplicate" actionListener="#{interactionController.cloneParticipant(wrapper)}"
                                rendered="#{wrapper.participant.ac != null}"
                                onclick="clone_articipant_dialog.show()" oncomplete="clone_articipant_dialog.hide()"
                                update="participantsTable,changesPanel,messagesComponent,shortlabelTxt"/>
                    <p:menuitem value="Delete" actionListener="#{interactionController.deleteParticipant(wrapper)}"
                                rendered="#{not wrapper.deleted}"
                                onclick="delParticipantDialog.show()" oncomplete="delParticipantDialog.hide()"
                                update="participantsTable,changesPanel,messagesComponent,shortlabelTxt"/>
                    <p:menuitem value="Revert" actionListener="#{interactionController.revertParticipant(wrapper)}"
                                icon="/resources/images/undo.png"
                                rendered="#{wrapper.deleted}"
                                onclick="revdelParticipantDialog.show()" oncomplete="revdelParticipantDialog.hide()"
                                update="participantsTable,changesPanel,messagesComponent"/>
                </p:menuButton>
            </p:column>

            <!--<f:facet name="expansion">-->
                <!--<h:panelGroup>-->
             <!--<h:panelGrid id="display" columns="6" cellpadding="4" style="width:600px"-->
                           <!--columnClasses="label, value, label, value, label, value">-->

                    <!--<h:outputLabel value="AC: " for="acTxt" class="intact-disabled"/>-->
                    <!--<h:inputText id="acTxt" value="#{wrapper.participant.ac}"-->
                                 <!--size="10" readonly="true" class="intact-disabled"/>-->

                    <!--<h:outputLabel value="Author given name: " for="authorGivenNameTxt"/>-->
                    <!--<h:inputText id="authorGivenNameTxt" value="#{wrapper.authorGivenName}" size="10">-->
                        <!--<f:ajax event="valueChange" listener="#{interactionController.changed}"/>-->
                    <!--</h:inputText>-->

                    <!--&lt;!&ndash;<h:outputLabel value="Delivery method: " for="deliveryInTxt"/>&ndash;&gt;-->
                    <!--&lt;!&ndash;<h:selectManyMenu id="deliveryInTxt" value="#{wrapper.participant.experimentalPreparations}"&ndash;&gt;-->
                            <!--&lt;!&ndash;converter="cvObjectConverter">&ndash;&gt;-->
                        <!--&lt;!&ndash;<f:selectItems value="#{cvObjectService.participantExperimentalPreparationsSelectItems}" />&ndash;&gt;-->
                    <!--&lt;!&ndash;</h:selectManyMenu>&ndash;&gt;-->

                    <!--<h:outputLabel value="Delivery method: " for="deliveryInTxt"/>-->
                    <!--<h:inputText id="deliveryInTxt" value="#{wrapper.firstExperimentalPreparation}"-->
                                 <!--size="20" readonly="true" class="intact-disabled"/>-->

                    <!--</h:panelGrid>-->

                    <!--<h4>Features (#{wrapper.participant.bindingDomains.size()}):</h4>-->

                    <!--<h:panelGroup rendered="#{not wrapper.participant.bindingDomains.isEmpty()}">-->
                        <!--<ui:include src="features_table.xhtml">-->
                            <!--<ui:param name="value" value="#{wrapper.participant.bindingDomains}"/>-->
                        <!--</ui:include>-->
                    <!--</h:panelGroup>-->

                <!--</h:panelGroup>-->

            <!--</f:facet>-->

        </p:dataTable>

        <ia:loadingDialog widgetVar="load_participant" message="Loading participant..."/>
        <ia:loadingDialog widgetVar="delParticipantDialog" message="Marking participant to be deleted..."/>
        <ia:loadingDialog widgetVar="revdelParticipantDialog" message="Reverting participant..."/>
        <ia:loadingDialog widgetVar="clone_articipant_dialog" message="Cloning participant..."/>

    </h:panelGroup>

    </ui:composition>