<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:ia="http://java.sun.com/jsf/composite/components/intact">

    <h:panelGroup id="participantsTable">

<ui:repeat value="#{value}" var="wrapper" varStatus="status">

            <ui:param name="participant" value="#{wrapper.participant}" />
            <ui:param name="interactor" value="#{participant.interactor}" />

            <div style="width: 960px; #{(status.index % 2) == 0 ? 'background-color: #f8f8ff;' : ''}};">

                <ia:collapsiblePanel open="false"
                                    titleRight="#{interactor.cvInteractorType.shortLabel} | #{interactor.bioSource.shortLabel} | #{interactor.fullName}"
                                    titleRightStyle="color:#999999;">

                    <f:facet name="title">
                        <h:panelGroup rendered="#{not wrapper.deleted}">
                            <p:commandLink onclick="load_participant.show()" action="#{curatorContextController.edit(participant)}"
                                           style="#{participant.ac == null? 'color:blue' :''}"
                                            value="#{interactor.shortLabel} (#{interactionController.getInteractorIdentity(participant.interactor)})"
                                            ajax="false"/>
                        </h:panelGroup>

                        <h:outputText value="#{interactor.shortLabel} (#{interactionController.getInteractorIdentity(participant.interactor)})"
                                      rendered="#{wrapper.deleted}" style="color:red; text-decoration:line-through"/>
                    </f:facet>

                    <f:facet name="right">
                        <p:menuButton value="Options">
                            <!--<p:menuitem value="Copy attributes..." onclick="alert('Not implemented')"/>-->
                            <p:menuitem value="Duplicate" actionListener="#{interactionController.cloneParticipant(wrapper)}"
                                        onclick="clone_articipant_dialog.show()" oncomplete="clone_articipant_dialog.hide()"
                                    update="participantsTable,changesPanel,messagesComponent,shortlabelTxt"/>
                            <p:menuitem value="Delete" actionListener="#{interactionController.deleteParticipant(wrapper)}"
                                        rendered="#{not wrapper.deleted}"
                                        onclick="delParticipantDialog.show()" oncomplete="delParticipantDialog.hide()"
                                        update="participantsTable,changesPanel,messagesComponent,shortlabelTxt"/>
                            <p:menuitem value="Revert" actionListener="#{interactionController.revertParticipant(wrapper)}"
                                        icon="/resources/images/undo.png"
                                        rendered="#{wrapper.deleted}"
                                        onclick="revdelParticipantDialog.show()" oncomplete="revdelParticipantDialog.hide()"
                                        update="participantsTable,changesPanel,messagesComponent"/>
                        </p:menuButton>
                    </f:facet>



                    <table class="tableBasicForm" width="900px" style="padding-left: 50px;">
                        <tr>
                            <td >
                                <h:outputLabel value="AC: " for="acTxt" class="intact-disabled"/>
                             </td>
                            <td>
                                <h:inputText id="acTxt" value="#{participant.ac}"
                                             size="10" disabled="true" class="intact-disabled"/>
                            </td>
                            <td style="text-align: right;">

                            </td>
                        </tr>
                        <tr>
                            <td class="firstCell">
                                <h:outputLabel value="Experimental role(s): " for="expRoleTxt"/>
                            </td>
                            <td >
                                <ia:inputCvObject id="expRoleTxt" cvIdentifier="MI:0495"
                                                  value="#{participant.cvExperimentalRole}"
                                                  selectItems="#{cvObjectService.experimentalRoleSelectItems}" />
                            </td>
                            <td style="padding-left: 150px;">
                                <h:outputLabel value="Stoichiometry: " for="stoichiometryTxt"/>
                                <p:spinner id="stoichiometryTxt" value="#{participant.stoichiometry}" stepFactor="1" size="3" maxlength="2"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="firstCell">
                                <h:outputLabel value="Biological role: " for="bioRoleTxt"/>
                            </td>
                            <td colspan="2">
                                <ia:inputCvObject id="bioRoleTxt" cvIdentifier="MI:0500"
                                                  value="#{participant.cvBiologicalRole}"
                                                  selectItems="#{cvObjectService.biologicalRoleSelectItems}" />
                            </td>
                        </tr>
                        <tr>
                            <td class="firstCell">
                                <h:outputLabel value="Expressed in: " for="expressedInTxt"/>
                            </td>
                            <td>
                                <ia:inputBioSource id="expressedInTxt" value="#{participant.expressedIn}"
                                                   selectItems="#{bioSourceService.bioSourceSelectItems}"/>
                            </td>
                            <td style="padding-left: 150px;">
                                <h:outputLabel value="Author given name: " for="authorGivenNameTxt"/>
                                <h:inputText id="authorGivenNameTxt" value="#{wrapper.authorGivenName}" size="10">
                                    <f:ajax event="valueChange" listener="#{interactionController.changed}"/>
                                </h:inputText>
                            </td>
                        </tr>
                        <tr>
                            <td class="firstCell">
                                <h:outputLabel value="Delivery method: " for="deliveryInTxt"/>
                            </td>
                            <td colspan="2">
                                <ia:inputCvObject id="deliveryInTxt" cvIdentifier="MI:0346"
                                                  selectItems="#{cvObjectService.participantExperimentalPreparationsSelectItems}"
                                                  value="#{wrapper.firstExperimentalPreparation}" />
                                <h:outputText value="#{fn:length(participant.experimentalPreparations) - 1} more..."
                                              rendered="#{fn:length(participant.experimentalPreparations) > 1}" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">

                                <h4>Features (#{participant.bindingDomains.size()})</h4>

                                <h:panelGroup rendered="#{not participant.bindingDomains.isEmpty()}">
                                    <ui:include src="features_table.xhtml">
                                        <ui:param name="value" value="#{participant.bindingDomains}"/>
                                    </ui:include>
                                </h:panelGroup>
                            </td>
                        </tr>
                    </table>

               </ia:collapsiblePanel>

            </div>

        </ui:repeat>

        <ia:loadingDialog widgetVar="load_participant" message="Loading participant..."/>
        <ia:loadingDialog widgetVar="delParticipantDialog" message="Marking participant to be deleted..."/>
        <ia:loadingDialog widgetVar="revdelParticipantDialog" message="Reverting participant..."/>
        <ia:loadingDialog widgetVar="clone_articipant_dialog" message="Cloning participant..."/>

    </h:panelGroup>

    </ui:composition>