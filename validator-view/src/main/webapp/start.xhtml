<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:tr="http://myfaces.apache.org/trinidad"
        xmlns:trh="http://myfaces.apache.org/trinidad/html"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:c="http://java.sun.com/jstl/core"
        xmlns:ebi="http://ebi.ac.uk/faces/components"

        template="/WEB-INF/facelets/layout/template.xhtml">

    <ui:define name="content">

        <trh:tableLayout width="100%">

            <trh:rowLayout>
                <trh:cellFormat>

                    <!-- Header -->
                    <trh:tableLayout width="100%">
                        <trh:rowLayout>
                            <trh:cellFormat halign="left">
                                <tr:goLink destination="http://psidev.sourceforge.net/" styleClass="text-align:left">
                                    <tr:image source="images/psi.gif" styleClass="border:0"/>
                                </tr:goLink>
                            </trh:cellFormat>
                            <trh:cellFormat halign="center">
                                <h1><tr:outputText value="The PSI-MI 2.5 Validator" styleClass="text-align:center"/></h1>
                            </trh:cellFormat>
                            <trh:cellFormat halign="right">
                                <tr:goLink destination="http://hupo.org/" styleClass="text-align:right">
                                    <tr:image source="images/hupo.gif" styleClass="border:0"/>
                                </tr:goLink>
                            </trh:cellFormat>
                        </trh:rowLayout>
                    </trh:tableLayout>

                </trh:cellFormat>
            </trh:rowLayout>


            <!-- Description -->

            <trh:rowLayout>
                <trh:cellFormat>

                    <tr:panelHeader text="Overview"/>

                    <tr:group>
                        <tr:outputText value="The PSI Validator validate files in "/>
                        <tr:goLink destination="http://www.psidev.info/index.php?q=node/60" targetFrame="_blank">
                            <tr:outputText value="PSI-MI 2.5"/>
                        </tr:goLink>
                        <tr:outputText value=" XML format."/>
                    </tr:group>

                </trh:cellFormat>
            </trh:rowLayout>


            <!-- File upload -->

            <trh:rowLayout>
                <trh:cellFormat>

                    <tr:spacer height="20" />

                    <tr:panelHeader text="Upload PSI-MI XML 2.5 data"/>

                    <trh:tableLayout borderWidth="0" cellPadding="5">
                        <trh:rowLayout>
                            <trh:cellFormat width="50" valign="top">
                                <tr:outputText value="Source: " />
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:selectOneRadio id="sourceSelector" value="local" simple="true"
                                                   valueChangeListener="#{psiValidatorBean.uploadTypeChanged}"
                                                   onchange="submit()">
                                    <tr:selectItem label="From local file" value="local"/>
                                    <tr:selectItem label="From URL" value="url"/>
                                </tr:selectOneRadio>
                            </trh:cellFormat>
                        </trh:rowLayout>

                        <trh:rowLayout rendered="#{psiValidatorBean.uploadLocalFile}">
                            <trh:cellFormat width="50" halign="right">
                                <tr:outputText value="File: " />
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:group>
                                    <tr:inputFile valueChangeListener="#{psiValidatorBean.onPsiFileUpload}" simple="true"/>
                                    <tr:message for="inputFile" styleClass="error-message"/>
                                </tr:group>
                            </trh:cellFormat>
                        </trh:rowLayout>

                        <trh:rowLayout rendered="#{!psiValidatorBean.uploadLocalFile}">
                            <trh:cellFormat width="50" halign="right">
                                <tr:outputText value="URL: "/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:group>
                                    <tr:inputText id="inputUrl" columns="80" value="#{psiValidatorBean.psiUrl}"
                                                  required="true" validator="#{psiValidatorBean.validateUrlFormat}"
                                                  simple="true"/>
                                    <tr:message for="inputUrl" styleClass="error-message" />
                                </tr:group>
                            </trh:cellFormat>
                        </trh:rowLayout>
                    </trh:tableLayout>

                    <tr:commandButton text="Validate" actionListener="#{psiValidatorBean.validate}"/>

                </trh:cellFormat>
            </trh:rowLayout>

            <tr:messages globalOnly="true"/>


            <!-- Uploaded file report table -->

            <trh:rowLayout>
                <trh:cellFormat>

                    <tr:spacer height="20" />

                    <tr:panelHeader text="Validation summary"
                                    rendered="#{psiValidatorBean.currentPsiReport != null}"/>

                    <trh:tableLayout borderWidth="0"
                                     cellSpacing="5"
                                     cellPadding="0"
                                     halign="left"
                                     width="600"
                                     rendered="#{psiValidatorBean.currentPsiReport != null}">
                        <trh:rowLayout>
                            <trh:cellFormat/>
                            <trh:cellFormat>Filename: </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:outputText value="#{psiValidatorBean.currentPsiReport.name}"/>
                            </trh:cellFormat>
                            <trh:cellFormat/>
                        </trh:rowLayout>

                        <trh:rowLayout>
                            <trh:cellFormat>
                                <tr:image source="images/icon_success_sml.gif"
                                                rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxValid}"/>
                                <tr:image source="images/icon_error_sml.gif"
                                                rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:outputText value="XML Syntax"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:outputText value="#{psiValidatorBean.currentPsiReport.xmlSyntaxStatus}"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:panelHorizontalLayout rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}">
                                    <tr:goLink destination="#xml_report">
                                        <tr:outputText value="Report"/>
                                    </tr:goLink>
                                    <tr:goLink destination="#html_view" rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxValid}">
                                        <tr:outputText value="HTML View"/>
                                    </tr:goLink>
                                </tr:panelHorizontalLayout>
                            </trh:cellFormat>
                        </trh:rowLayout>

                        <trh:rowLayout>
                            <trh:cellFormat>
                                <tr:image source="images/icon_success_sml.gif"
                                                rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticValid}"/>
                                <tr:image source="images/icon_warning_sml.gif"
                                                rendered="#{psiValidatorBean.currentPsiReport.semanticsStatus == 'warnings'}"/>
                                <tr:image source="images/icon_error_sml.gif"
                                                rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticInvalid}"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:outputText value="XML Semantics"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:outputText value="#{psiValidatorBean.currentPsiReport.semanticsStatus}"/>
                            </trh:cellFormat>
                            <trh:cellFormat>
                                <tr:goLink destination="#semantics_report" rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticInvalid}">
                                    <tr:outputText value="Report"/>
                                </tr:goLink>
                            </trh:cellFormat>
                        </trh:rowLayout>
                    </trh:tableLayout>

                </trh:cellFormat>
            </trh:rowLayout>

        </trh:tableLayout>


        <tr:spacer height="20" />    

        <!-- XML Syntax Validation Report -->
        <tr:group rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}">

            <tr:group>
                <a name="xml_report"/>
                <tr:panelHeader text="XML Syntax Validation Report"/>
                <!--<tr:outputText value="#{psiValidatorBean.currentPsiReport.xmlSyntaxReport}" styleClass="report"/>-->
            </tr:group>

            <tr:table width="800" var="msg" value="#{psiValidatorBean.currentPsiReport.xmlSyntaxReport}">
                <tr:column >
                    <tr:image source="images/icon_warning_sml.gif" rendered="#{msg.level == 'WARN'}" shortDesc="#{msg.level}"/>
                    <tr:image source="images/icon_error_sml.gif" rendered="#{msg.level == 'ERROR'}" shortDesc="#{msg.level}"/>
                    <tr:image source="images/icon_error_sml.gif" rendered="#{msg.level == 'FATAL'}" shortDesc="#{msg.level}"/>
                </tr:column>

                <tr:column headerText="Description">
                    <tr:outputText value="#{msg.message}" />
                </tr:column>

                <!-- Build a links to respective object anchor's -->
                <!--<tr:column headerText="Context">-->
                    <!--<tr:outputText value="Line #{msg.context.lineNumber}"/>-->
                <!--</tr:column>-->
            </tr:table>
        </tr:group>


        <!-- XML Semantic Validation Report (if any messages) -->
        <tr:group rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticInvalid}">
            <a name="semantics_report"/>
            <tr:panelHeader text="PSI MI 2.5 Semantic Validation Report"/>
            <!--<pre>-->
               <!--<tr:outputText value="#{psiValidatorBean.currentPsiReport.semanticsReport}" styleClass="report"/>-->
            <!--</pre>-->
            <tr:outputText value="#{psiValidatorBean.currentPsiReport.messageCount} message#{psiValidatorBean.currentPsiReport.messageCount >1 ? 's' : ''}" />

            <tr:table var="msg" value="#{psiValidatorBean.currentPsiReport.validatorMessages}">
                <tr:column >
                    <tr:image source="images/icon_warning_sml.gif" rendered="#{msg.level == 'WARN'}" shortDesc="#{msg.level}"/>
                    <tr:image source="images/icon_error_sml.gif" rendered="#{msg.level == 'ERROR'}" shortDesc="#{msg.level}"/>
                    <tr:image source="images/icon_error_sml.gif" rendered="#{msg.level == 'FATAL'}" shortDesc="#{msg.level}"/>
                </tr:column>
                
                <tr:column headerText="Description">
                        <tr:outputText value="#{msg.message}" />
                </tr:column>

                <!-- Build a links to respective object anchor's -->
                <tr:column headerText="Context">
                    <tr:goLink destination="#e#{msg.context.experimentId}" rendered="#{msg.context.experimentId != -1}">
                        <nobr><tr:outputText value="Experiment ##{msg.context.experimentId}" /></nobr>
                    </tr:goLink>
                    <tr:goLink destination="#ix#{msg.context.interactionId}" rendered="#{msg.context.interactionId != -1}">
                        <nobr><tr:outputText value="Interaction ##{msg.context.interactionId}" /></nobr>
                    </tr:goLink>
                    <tr:goLink destination="#p#{msg.context.participantId}" rendered="#{msg.context.participantId != -1}">
                        <nobr><tr:outputText value="Participant ##{msg.context.participantId}" /></nobr>
                    </tr:goLink>
                    <tr:goLink destination="#i#{msg.context.interactorId}" rendered="#{msg.context.interactorId != -1}">
                        <nobr><tr:outputText value="Interactor ##{msg.context.interactorId}" /></nobr>
                    </tr:goLink>
                    <tr:goLink destination="#f#{msg.context.featureId}" rendered="#{msg.context.featureId != -1}">
                        <nobr><tr:outputText value="Feature ##{msg.context.featureId}" /></nobr>
                    </tr:goLink>
                </tr:column>
            </tr:table>

        </tr:group>


        <!-- HTML View -->
        <tr:group rendered="#{psiValidatorBean.currentPsiReport != null and psiValidatorBean.currentPsiReport.xmlSyntaxValid}">
            <tr:spacer height="20" />
            <a name="html_view"/>
            <tr:panelHeader text="HTML View"/>
            <div>
                <tr:outputText value="#{psiValidatorBean.currentPsiReport.htmlView}" escape="false"/>
            </div>
        </tr:group>

    </ui:define>

</ui:composition>