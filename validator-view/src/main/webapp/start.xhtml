<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:tr="http://myfaces.apache.org/trinidad"
        xmlns:trh="http://myfaces.apache.org/trinidad/html"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:c="http://java.sun.com/jstl/core"
        xmlns:ebi="http://ebi.ac.uk/faces/components"

        template="/WEB-INF/facelets/layout/template.xhtml">

    <ui:define name="content">

        <h:panelGrid columns="1" style="width:100%">

            <!-- Header -->
            <trh:tableLayout width="100%">
                <trh:rowLayout>
                    <trh:cellFormat halign="left">
                        <h:outputLink value="http://psidev.sourceforge.net/" styleClass="text-align:left">
                            <h:graphicImage url="images/psi.gif" style="border:0"/>
                        </h:outputLink>
                    </trh:cellFormat>
                    <trh:cellFormat halign="center">
                        <h1><h:outputText value="The PSI Validator" styleClass="text-align:center"/></h1>
                    </trh:cellFormat>
                    <trh:cellFormat halign="right">
                        <h:outputLink value="http://hupo.org/" styleClass="text-align:right">
                            <h:graphicImage url="images/hupo.gif" style="border:0"/>
                        </h:outputLink>
                    </trh:cellFormat>
                </trh:rowLayout>
            </trh:tableLayout>

            <!-- Description -->
            <tr:panelHeader text="Overview"/>

            <h:panelGroup>
                <h:outputText value="The PSI Validator validate files in "/>
                <h:outputLink value="http://psidev.sourceforge.net/mi/rel25/" target="_blank">
                    <h:outputText value="PSI MI 2.5"/>
                </h:outputLink>
                <h:outputText value=" XML format."/>
            </h:panelGroup>

            <!-- File upload -->
            <tr:panelHeader text="Upload PSI-MI XML 2.5 data"/>

            <h:panelGroup>
                <h:outputLabel for="sourceSelector" value="Source: "/>
                <h:selectOneRadio id="sourceSelector" value="local" layout="pageDirection"
                                  valueChangeListener="#{psiValidatorBean.uploadTypeChanged}"
                                  onchange="submit()">
                    <f:selectItem itemLabel="From local file" itemValue="local"/>
                    <f:selectItem itemLabel="From URL" itemValue="url"/>
                </h:selectOneRadio>
            </h:panelGroup>

            <tr:panelGroupLayout rendered="#{psiValidatorBean.uploadLocalFile}">
                <tr:panelHorizontalLayout>
                    <tr:inputFile label="File:" valueChangeListener="#{psiValidatorBean.onPsiFileUpload}"/>
                </tr:panelHorizontalLayout>
                <tr:message for="inputFile" styleClass="error-message"/>
            </tr:panelGroupLayout>

            <tr:panelHorizontalLayout rendered="#{!psiValidatorBean.uploadLocalFile}">
                <tr:panelHorizontalLayout>
                    <tr:inputText id="inputUrl" label="URL: " columns="80" value="#{psiValidatorBean.psiUrl}"
                                  required="true" validator="#{psiValidatorBean.validateUrlFormat}"/>
                </tr:panelHorizontalLayout>
                <tr:message for="inputUrl" styleClass="error-message" />
            </tr:panelHorizontalLayout>

            <tr:commandButton text="Validate" actionListener="#{psiValidatorBean.validate}"/>

            <tr:messages globalOnly="true"/>

            <!-- Uploaded file report table -->
            <tr:panelHeader text="Validation summary"
                    rendered="#{psiValidatorBean.currentPsiReport != null}"/>

            <trh:tableLayout borderWidth="0"
                             cellSpacing="15"
                             cellPadding="0"
                             halign="left"
                             width="400"
                             rendered="#{psiValidatorBean.currentPsiReport != null}">
                <trh:rowLayout>
                    <trh:cellFormat/>
                    <trh:cellFormat>Filename: </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputText value="#{psiValidatorBean.currentPsiReport.name}"/>
                    </trh:cellFormat>
                    <trh:cellFormat/>
                </trh:rowLayout>

                <trh:rowLayout>
                    <trh:cellFormat>
                        <h:graphicImage url="images/icon_success_sml.gif"
                                        rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxValid}"/>
                        <h:graphicImage url="images/icon_error_sml.gif"
                                        rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputText value="XML Syntax"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputText value="#{psiValidatorBean.currentPsiReport.xmlSyntaxStatus}"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <tr:panelHorizontalLayout rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}">
                            <h:outputLink value="#xml_report">
                                <h:outputText value="Report"/>
                            </h:outputLink>
                            <h:outputLink value="#html_view" rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxValid}">
                                <h:outputText value="HTML View"/>
                            </h:outputLink>
                        </tr:panelHorizontalLayout>
                    </trh:cellFormat>
                </trh:rowLayout>

                <trh:rowLayout>
                    <trh:cellFormat>
                        <h:graphicImage url="images/icon_success_sml.gif"
                                        rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticValid}"/>
                        <h:graphicImage url="images/icon_warning_sml.gif"
                                        rendered="#{psiValidatorBean.currentPsiReport.semanticsStatus == 'warnings'}"/>
                        <h:graphicImage url="images/icon_error_sml.gif"
                                        rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticInvalid}"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputText value="XML Semantics"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputText value="#{psiValidatorBean.currentPsiReport.semanticsStatus}"/>
                    </trh:cellFormat>
                    <trh:cellFormat>
                        <h:outputLink value="#semantics_report" rendered="#{psiValidatorBean.currentPsiReport.semanticsReport != null}">
                            <h:outputText value="Report"/>
                        </h:outputLink>
                    </trh:cellFormat>
                </trh:rowLayout>
            </trh:tableLayout>

        </h:panelGrid>

        <!-- XML Syntax Validation Report -->
        <h:panelGrid columns="1" rendered="#{psiValidatorBean.currentPsiReport.xmlSyntaxInvalid}">
            <a name="xml_report"/>
            <tr:panelHeader text="XML Syntax Validation Report"/>
            <h:outputText value="#{psiValidatorBean.currentPsiReport.xmlSyntaxReport}" styleClass="report"/>

            <tr:table var="msg" value="#{psiValidatorBean.currentPsiReport.xmlSyntaxReport}">
                <tr:column >
                    <h:graphicImage url="images/icon_warning_sml.gif" rendered="#{msg.level == 'WARN'}" title="#{msg.level}"/>
                    <h:graphicImage url="images/icon_error_sml.gif" rendered="#{msg.level == 'ERROR'}" title="#{msg.level}"/>
                    <h:graphicImage url="images/icon_error_sml.gif" rendered="#{msg.level == 'FATAL'}" title="#{msg.level}"/>
                </tr:column>

                <tr:column headerText="Description">
                    <tr:outputText value="#{msg.message}" />
                </tr:column>

                <!-- Build a links to respective object anchor's -->
                <tr:column headerText="Context">
                    <h:outputText value="#{msg.context}"/>
                </tr:column>
            </tr:table>
        </h:panelGrid>


        <!-- XML Semantic Validation Report (if any messages) -->
        <h:panelGrid columns="1" rendered="#{psiValidatorBean.currentPsiReport.xmlSemanticInvalid}">
            <a name="semantics_report"/>
            <tr:panelHeader text="PSI MI 2.5 semantic validation report"/>
            <pre>
               <h:outputText value="#{psiValidatorBean.currentPsiReport.semanticsReport}" styleClass="report"/>
            </pre>

            <tr:table var="msg" value="#{psiValidatorBean.currentPsiReport.validatorMessages}">
                <tr:column >
                    <h:graphicImage url="images/icon_warning_sml.gif" rendered="#{msg.level == 'WARN'}" title="#{msg.level}"/>
                    <h:graphicImage url="images/icon_error_sml.gif" rendered="#{msg.level == 'ERROR'}" title="#{msg.level}"/>
                    <h:graphicImage url="images/icon_error_sml.gif" rendered="#{msg.level == 'FATAL'}" title="#{msg.level}"/>
                </tr:column>
                
                <tr:column headerText="Description">
                        <tr:outputText value="#{msg.message}" />
                </tr:column>

                <!-- Build a links to respective object anchor's -->
                <tr:column headerText="Context">
                    <h:outputLink value="#e#{msg.context.experimentId}" rendered="#{msg.context.experimentId != -1}">
                        <nobr><tr:outputText value="Experiment ##{msg.context.experimentId}" /></nobr>
                    </h:outputLink>
                    <h:outputLink value="#ix#{msg.context.interactionId}" rendered="#{msg.context.interactionId != -1}">
                        <nobr><tr:outputText value="Interaction ##{msg.context.interactionId}" /></nobr>
                    </h:outputLink>
                    <h:outputLink value="#p#{msg.context.participantId}" rendered="#{msg.context.participantId != -1}">
                        <nobr><tr:outputText value="Participant ##{msg.context.participantId}" /></nobr>
                    </h:outputLink>
                    <h:outputLink value="#i#{msg.context.interactorId}" rendered="#{msg.context.interactorId != -1}">
                        <nobr><tr:outputText value="Interactor ##{msg.context.interactorId}" /></nobr>
                    </h:outputLink>
                    <h:outputLink value="#f#{msg.context.featureId}" rendered="#{msg.context.featureId != -1}">
                        <nobr><tr:outputText value="Feature ##{msg.context.featureId}" /></nobr>
                    </h:outputLink>
                </tr:column>
            </tr:table>

        </h:panelGrid>

        <!-- HTML View -->
        <h:panelGrid columns="1" rendered="#{psiValidatorBean.currentPsiReport != null and psiValidatorBean.currentPsiReport.xmlSyntaxValid}">
            <a name="html_view"/>
            <tr:panelHeader text="HTML View"/>
            <h:outputText value="#{psiValidatorBean.currentPsiReport.htmlView}" escape="false"/>
        </h:panelGrid>

    </ui:define>

</ui:composition>