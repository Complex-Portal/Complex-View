<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:trh="http://myfaces.apache.org/trinidad/html"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:ebi="http://ebi.ac.uk/faces/components"
                xmlns:ebisf="http://www.ebi.ac.uk/faces/site"
                xmlns:iaf="http://intact.ebi.ac.uk/functions"
                xmlns:iav="http://intact.ebi.ac.uk/view"
                template="WEB-INF/facelets/layout/template.xhtml">

<!-- content -->
  <ui:define name="content">

  <tr:panelGroupLayout partialTriggers="searchAgainBtn btnInteractions btnInteractors btnExperiments btnControlledVocab">

      <tr:panelBox background="dark" inlineStyle="width:400px">
          <tr:panelGroupLayout layout="horizontal">
           <tr:inputText label="Query:" value="#{searchBean.searchQuery}"/>
          <tr:commandButton id="searchAgainBtn" partialSubmit="true"
                            text="Search" actionListener="#{searchBean.doSearchAll}"/>
          </tr:panelGroupLayout>
      </tr:panelBox>

      <tr:panelHeader text="Search summary" rendered="#{searchBean.searchClassName == null}">

          <iav:panelCategory id="resultsPanel">
              <iav:panelCategoryColumn>
                  <iav:categoryGroup id="interactionGroup" title="Interactions">
                      <iav:categoryItem name="Interactions"
                                        description="Interaction data found in the database"
                                        size="#{searchBean.resultStats.interactionCount}"
                                        category="none">
                          <tr:commandLink id="btnInteractions" partialSubmit="true"
                                          text="View interactions"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.InteractionImpl"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                  </iav:categoryGroup>
                  <iav:categoryGroup id="experimentCount" title="Experiments">
                      <iav:categoryItem name="Interactions"
                                        description="Experiments found in the database"
                                        size="#{searchBean.resultStats.experimentCount}"
                                        category="none">
                          <tr:commandLink id="btnExperiments" partialSubmit="true"
                                          text="View experiments"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.Experiment"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                  </iav:categoryGroup>
                  <iav:categoryGroup id="cvObjectCount" title="Controlled Vocabularies"
                                     initiallyExpanded="true">
                      <iav:categoryItem name="Controlled Vocabularies"
                                        description="CVs found in the database"
                                        size="#{searchBean.resultStats.cvObjectCount}"
                                        category="none">
                          <tr:commandLink id="btnCvObjects" partialSubmit="true"
                                          text="View controlled vocabularies"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.CvObject"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                  </iav:categoryGroup>

              </iav:panelCategoryColumn>
              <iav:panelCategoryColumn>
                  <iav:categoryGroup id="interactorGroup" title="Interactors"
                                     initiallyExpanded="true">
                      <iav:categoryItem name="Nucleic Acids"
                                        description="Nucleic acids found in the database"
                                        size="#{searchBean.resultStats.nucleicAcidCount}"
                                        category="none">
                          <tr:commandLink id="btnNucAcids" partialSubmit="true"
                                          text="View nucleic acids"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.NucleicAcidImpl"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                      <iav:categoryItem name="Proteins"
                                        description="Proteins found in the database"
                                        size="#{searchBean.resultStats.proteinCount}"
                                        category="none">
                          <tr:commandLink id="btnProteins" partialSubmit="true"
                                          text="View proteins"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.ProteinImpl"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                      <iav:categoryItem name="Small Molecules"
                                        description="Small molecules found in the database"
                                        size="#{searchBean.resultStats.smallMoleculeCount}"
                                        category="none">
                          <tr:commandLink id="btnSmallMol" partialSubmit="true"
                                          text="View small molecules"
                                          actionListener="#{searchBean.doSearchClass}">
                              <f:param value="uk.ac.ebi.intact.model.SmallMoleculeImpl"/>
                          </tr:commandLink>
                      </iav:categoryItem>
                  </iav:categoryGroup>
              </iav:panelCategoryColumn>
          </iav:panelCategory>


      </tr:panelHeader>

      <!-- Interactions -->

      <tr:panelHeader text="Interactions" rendered="#{ searchBean.searchClassName == 'uk.ac.ebi.intact.model.InteractionImpl'}"
              partialTriggers="btnInteractions">

          <ui:composition template="pages/interaction/interaction_table.xhtml">
              <ui:define name="footer">
                  <tr:panelGroupLayout layout="vertical">
                      <h:commandLink value="View selected in HierarchView"
                                     actionListener="#{interactorResultsBean.exportSelectedToHierarchView}"/>
                  </tr:panelGroupLayout>
              </ui:define>

              <ui:param name="binding" value="#{interactionResultsBean.resultsTable}"/>
              <ui:param name="values" value="#{searchBean.searchResults}"/>
          </ui:composition>
      </tr:panelHeader>

      <!-- Interactors -->

      <tr:panelHeader text="Interactors" rendered="#{searchBean.searchClassName == 'uk.ac.ebi.intact.model.InteractorImpl'}">
          <ui:composition template="/pages/interactor/interactor_table.xhtml">
              <ui:define name="footer">
                  <tr:panelGroupLayout layout="vertical">
                    <h:commandLink value="View selected to HierarchView"
                                      actionListener="#{interactorResultsBean.exportSelectedToHierarchView}"/>
                    <h:commandLink value="View selected in InterPro"
                                      actionListener="#{interactorResultsBean.exportSelectedToInterPro}"/>
                </tr:panelGroupLayout>
              </ui:define>

              <ui:param name="binding" value="#{interactionResultsBean.resultsTable}"/>
              <ui:param name="values" value="#{searchBean.searchResults}"/>
          </ui:composition>

      </tr:panelHeader>

      <!-- Experiments -->

      <tr:panelHeader text="Experiments" rendered="#{searchBean.searchClassName == 'uk.ac.ebi.intact.model.Experiment'}">
          <tr:table binding="#{experimentResultsBean.resultsTable}"
                    var="ao" value="#{searchBean.searchResults}"
                    rowBandingInterval="1" rows="25">

              <tr:column headerText="Name" sortable="true" sortProperty="shortLabel">
                  <tr:outputText value="#{ao.shortLabel}"/>
              </tr:column>
              <tr:column headerText="AC" sortable="true" sortProperty="ac">
                  <tr:outputText value="#{ao.ac}"/>
              </tr:column>
              <tr:column headerText="Description" sortable="true" sortProperty="fullName">
                  <tr:outputText value="#{ao.fullName}"/>
              </tr:column>
              <tr:column headerText="Detection Method" sortable="true" sortProperty="cvIdentification">
                  <tr:outputText value="#{ao.cvIdentification.shortLabel} (#{ao.cvIdentification.miIdentifier})"/>
              </tr:column>
              <tr:column headerText="Interaction Type" sortable="true" sortProperty="cvInteraction">
                  <tr:outputText value="#{ao.cvInteraction.shortLabel} (#{ao.cvInteraction.miIdentifier})"/>
              </tr:column>
              <tr:column headerText="Organism" sortable="true" sortProperty="bioSource">
                  <tr:outputText value="#{ao.bioSource.shortLabel} (#{ao.bioSource.taxId})"/>
              </tr:column>
              <tr:column headerText="Interactions" sortable="true" sortProperty="interactionsCount">
                  <tr:outputText value="#{ao.interactionsCount}"/>
              </tr:column>

          </tr:table>

       </tr:panelHeader>

       <!-- CVObjects -->

      <tr:panelHeader text="Controlled Vocabularies" rendered="#{searchBean.searchClassName == 'uk.ac.ebi.intact.model.CvObject'}">
          <tr:table binding="#{cvObjectResultsBean.resultsTable}"
                    var="ao" value="#{searchBean.searchResults}"
                    rowBandingInterval="1" rows="25">

              <tr:column headerText="Name" sortable="true" sortProperty="shortLabel">
                  <tr:outputText value="#{ao.shortLabel}"/>
              </tr:column>
              <tr:column headerText="MI Identifier" sortable="true" sortProperty="miIdentifier">
                  <tr:outputText value="#{ao.miIdentifier}"/>
              </tr:column>
              <tr:column headerText="AC" sortable="true" sortProperty="ac">
                  <tr:outputText value="#{ao.ac}"/>
              </tr:column>
              <tr:column headerText="Description" sortable="true" sortProperty="fullName">
                  <tr:outputText value="#{ao.fullName}"/>
              </tr:column>

          </tr:table>

      </tr:panelHeader>

  </tr:panelGroupLayout>

  </ui:define>
  
</ui:composition>