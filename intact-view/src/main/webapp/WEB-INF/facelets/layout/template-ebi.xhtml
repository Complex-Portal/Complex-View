<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ebisf="http://www.ebi.ac.uk/faces/site">

<f:view contentType="text/html">

    <h:head>
        <title>#{intactView['webapp.name']}</title>

        <meta http-equiv="Content-Type"
              content="text/html; charset=UTF-8"/>

        <meta name="description" content="#{intactView['webapp.name']}"/>

        <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/contents.css" type="text/css"/>
        <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/userstyles.css" type="text/css"/>
        <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/sidebars.css" type="text/css"/>


        <link rel="stylesheet" type="text/css" href="#{facesContext.externalContext.request.contextPath}/resources/css/ebi/skin.css"></link>
        <link rel="stylesheet" href="#{facesContext.externalContext.request.contextPath}/resources/css/intact-extra.css" type="text/css"/>
        <link rel="stylesheet" href="#{facesContext.externalContext.request.contextPath}/resources/css/twitter/intact-tweet.css" type="text/css"/>

        <script src="#{ebisf:absoluteEbiUrl()}/inc/js/contents.js" type="text/javascript"></script>

        <h:outputScript library="javascript" name="intact.js"/>
        <h:outputScript library="javascript" name="twitter/jquery.tweet.js"/>

        <script type="text/javascript">
            // fixup for an issue of the jsf2.0 and 2.1 ajax
            // spec to deal with multiple forms per page.
            // => ViewExpiredException occurs if you heavy use ajax within
            //    more than one form (MYFACES-3159)
            window.myfaces = window.myfaces || {};
            myfaces.config = myfaces.config || {};
            myfaces.config.no_portlet_env = true;
        </script>

        <ui:insert name="additionalHeader"/>

        <!-- Google Analytics -->
        <ui:param name="googleTracker" value="#{intactViewConfiguration.googleAnalyticsTracker}"/>

        <h:panelGroup>
            <script type="text/javascript">

                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', '#{intactViewConfiguration.googleAnalyticsTracker}']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

                </script>

        </h:panelGroup>
    </h:head>

    <h:body>
        <h:form id="intactForm" prependId="false">

        <ui:insert name="dialogs"/>

            <!-- EBI header -->
            <div class="headerdiv" id="headerdiv"
                 style="position:absolute; z-index: 1;">

                <iframe src="http://www.ebi.ac.uk/inc/head.html" name="head" id="head" frameborder="0" marginwidth="0"
                        marginheight="0"
                        scrolling="no" width="100%" style="position:absolute; z-index: 1; height: 57px;"></iframe>
            </div>

            <!-- Contents -->
            <div class="contents" id="contents">

            <table class="contentspane" id="contentspane" summary="The main content pane of the page"
                   style="width: 100%">
                <tr>
                    <td class="leftmargin">
                        <img src="http://www.ebi.ac.uk/inc/images/spacer.gif" class="spacer" alt="spacer"/>
                    </td>

                    <h:panelGroup rendered="#{!hideSidebar}">
                        <td class="leftmenucell" id="leftmenucell">
                            <div class="leftmenu" id="leftmenu"
                                 style="width: 145px; visibility: visible; display: block;">
                                <!-- InstanceBeginEditable name="leftnav" -->

                                <!-- start left menu here  -->
                                    <ui:insert name="sidebar"/>

                            </div>
                        </td>
                    </h:panelGroup>

                    <td class="contentsarea" id="contentsarea">
                        <!-- InstanceBeginEditable name="contents" -->

                        <!-- breadcrumbs -->
                        <ui:insert name="breadcrumbs"/>

                        <!-- start contents here -->

                        <!--<tr:statusIndicator id="status">-->
                            <!--<f:facet name="busy">-->
                                <!--<tr:panelGroupLayout layout="horizontal">-->
                                    <!--<tr:image source="/skins/ebi/images/status_busy_redback.gif"-->
                                              <!--inlineStyle="vertical-align:middle"/>-->
                                    <!--<tr:outputFormatted value="&#160;"/>-->
                                    <!--<tr:outputText value="Loading..."/>-->
                                <!--</tr:panelGroupLayout>-->
                            <!--</f:facet>-->
                        <!--</tr:statusIndicator>-->

                        <div id="statusIndicator" class="status-normal"></div>

                        <p:ajaxStatus onstart="document.getElementById('statusIndicator').setAttribute('class', 'status-busy')"
                                      oncomplete="document.getElementById('statusIndicator').setAttribute('class', 'status-normal')">
                            <f:facet name="start">
                                <div class="busyStatus">
                                    <h:graphicImage alt="busy" url="/skins/ebi/images/status_busy_redback.gif"
                                                    style="vertical-align:middle;"/>
                                    &#160;
                                    <h:outputText value="Loading..."/>
                                </div>
                            </f:facet>

                            <f:facet name="complete">
                                <div>
                                    <h:outputText value="" />
                                </div>
                            </f:facet>

                            <f:facet name="success">
                                 <div>
                                    <h:outputText value="" />
                                </div>
                            </f:facet>

                            <f:facet name="error">
                                 <div class="busyStatus">
                                    <h:graphicImage alt="busy" url="/skins/ebi/images/status_busy_redback.gif"
                                                    style="vertical-align:middle;"/>
                                    &#160;
                                    <h:outputText value="Error :("/>
                                </div>
                            </f:facet>
                        </p:ajaxStatus>

                        <table style="width:100%">
                            <tr>
                                <td>
                                    <ui:insert name="content"/>
                                </td>
                            </tr>
                        </table>


                    </td>
                    <td class="rightmenucell" id="rightmenucell">
                        <div class="rightmenu" id="rightmenu">
                            <ui:insert name="right">
                                 <img src="http://www.ebi.ac.uk/inc/images/spacer.gif" class="spacer" alt="spacer"/>
                            </ui:insert>
                        </div>
                    </td>
                </tr>
            </table>

                <table class="footerpane" id="footerpane" summary="The main footer pane of the page">
                    <tr>
                        <td colspan="4" class="footerrow">
                            <div class="footerdiv" id="footerdiv" style="z-index:2;">
                                <iframe src="http://www.ebi.ac.uk/inc/foot.html" name="foot" frameborder="0"
                                        marginwidth="0"
                                        marginheight="0"
                                        scrolling="no" height="22" width="100%" style="z-index:2;"></iframe>
                            </div>
                        </td>
                    </tr>
                </table>

                <script src="http://www.ebi.ac.uk/inc/js/footer.js" type="text/javascript"></script>

        </div>

             <!-- To avoid expired sessions, poll every 25 mins -->

        <p:poll interval="#{25*60*1000}" process="@this"/>

        </h:form>

    </h:body>

    </f:view>

    </html>
