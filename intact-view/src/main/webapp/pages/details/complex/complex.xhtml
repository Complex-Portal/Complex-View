<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:jsp="http://java.sun.com/JSP/Page"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:ebi="http://ebi.ac.uk/faces/components"
                xmlns:iav="http://intact.ebi.ac.uk/view"
                xmlns:trh="http://myfaces.apache.org/trinidad/html"
                xmlns:iaf="http://intact.ebi.ac.uk/functions"
                xmlns:iam="http://intact.ebi.ac.uk/miscel"

                template="/main.xhtml">

    <ui:param name="disclosedTabName" value="details"/>

    <ui:define name="detailsTabContent">

        <tr:spacer height="5"/>

        <tr:panelHorizontalLayout valign="middle">
            <tr:image source="/images/back_arrow.gif"/>
            <tr:commandLink text="Back to Interaction Details" action="details"/>
        </tr:panelHorizontalLayout>

        <c:set var="matrix" value="#{detailsBean.similarInteractionMatrix}"/>

        <tr:panelHeader text="Similarity search for complex interaction">

            <c:set var="interaction" value="#{detailsBean.interaction}"/>
            <tr:panelFormLayout inlineStyle="width:100%">

                <tr:panelLabelAndMessage label="Accession:" labelStyle="font-weight:bold;">
                    <tr:outputText value="#{interaction.ac}"/>
                </tr:panelLabelAndMessage>

                <tr:panelLabelAndMessage label="Name:" labelStyle="font-weight:bold;">
                    <tr:outputText value="#{interaction.shortLabel}"/>
                </tr:panelLabelAndMessage>

                <tr:panelLabelAndMessage label="Participant count:" labelStyle="font-weight:bold;">
                    <tr:outputText value="#{fn:length( interaction.components )}"/>
                </tr:panelLabelAndMessage>

                <tr:panelLabelAndMessage label="Similar interaction count:" labelStyle="font-weight:bold;">
                    <tr:outputText value="#{fn:length( matrix.similarInteractions )}"/>
                </tr:panelLabelAndMessage>

            </tr:panelFormLayout>

            <br/>

            <trh:tableLayout borderWidth="0" cellSpacing="0" cellPadding="0">

                <!-- Table Header-->
                <tr>
                    <td valign="bottom" style="border-bottom: solid 1px #cdcdcd;font-weight:bold;">
                        <tr:outputText value="Interactions" />
                    </td>

                    <td colspan="#{fn:length( matrix.members ) + 1}" style="border-bottom: solid 1px #cdcdcd;">
                        <!--TODO try color management later (eg. &amp;tc=&#35;000000")-->
                        <tr:image source="/tableHeader?time=#{iam:currentTimeMillis()}&amp;s=31&amp;fs=12&amp;h=100&amp;st=true&amp;lc=%23cdcdcd" />
                    </td>

                    <td valign="bottom" style="font-weight:bold; border-bottom: solid 1px #cdcdcd;">Other participants</td>
                </tr>

                <!-- Table Body-->
                <tr:iterator value="#{matrix.similarInteractions}" var="si" rows="0">

                    <tr>

                        <td align="right">
                            <tr:panelHorizontalLayout>
                                <tr:commandLink action="details">
                                    <tr:outputText value="#{si.shortLabel}" shortDesc="#{si.fullName}" />
                                    <f:setPropertyActionListener value="#{si.ac}" target="#{detailsBean.interactionAc}"/>
                                </tr:commandLink>
                                <tr:spacer width="10" />
                            </tr:panelHorizontalLayout>
                        </td>

                        <tr:iterator value="#{matrix.members}" var="member" rows="0" varStatus="index">

                            <c:set var="style" value="#{(index.count eq fn:length(matrix.members) ? 'border-left: solid 1px #cdcdcd; border-right: solid 1px #cdcdcd;' : 'border-left: solid 1px #cdcdcd;')}" />

                            <td align="center" width="30" style="#{style}">

                                <c:set var="display" value="#{iam:isMemberPresent( si, member )}" />

                                <tr:outputText value=" " rendered="#{!display}" />

                                <tr:image source="/images/ok.gif" rendered="#{display}"
                                          shortDesc="This molecule is present in this interaction"/>

                            </td>

                        </tr:iterator>

                        <td>&#160;<!-- Cell necessary to cope with the end of the table header--></td>

                        <td>
                            <iam:collapsibleIterator id="mtx_participant_#{status.index}"
                                                     disclosed="false"
                                                     value="#{si.others}"
                                                     maxShown="3">

                                 <!--TODO link to Dasty2-->
                                <tr:outputText value="#{item.shortLabel}" shortDesc="#{item.fullName}"/>

                            </iam:collapsibleIterator>
                        </td>

                    </tr>

                </tr:iterator>

            </trh:tableLayout>

        </tr:panelHeader>

    </ui:define>

</ui:composition>