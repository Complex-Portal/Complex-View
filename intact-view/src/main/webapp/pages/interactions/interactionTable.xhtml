<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.prime.com.tr/ui"

                xmlns:iamf="http://intact.ebi.ac.uk/mitabfunctions"
                xmlns:iav="http://intact.ebi.ac.uk/view"
                xmlns:iax="http://intact.ebi.ac.uk/extlinks"

                xmlns:iam="http://java.sun.com/jsf/composite/components/miscel"
                xmlns:iv="http://java.sun.com/jsf/composite/components/intactview">


    <p:panel>
        <p:commandButton value="Change Columns Displayed" onclick="columnsDialog.show()"/>
    </p:panel>

    <p:dialog header="Columns displayed" fixedCenter="true" widgetVar="columnsDialog">
        Select:
        <p:commandLink value="Minium" actionListener="#{columnContext.selectMininumColumns()}" update="columnSelection"/>
        &#160;|&#160;
        <p:commandLink value="Standard" actionListener="#{columnContext.selectStandardColumns()}" update="columnSelection"/>
        &#160;|&#160;
        <p:commandLink value="Expanded" actionListener="#{columnContext.selectExpandedColumns()}" update="columnSelection"/>
        <hr/>

        <h:selectManyCheckbox id="columnSelection" value="#{columnContext.selectedColumns}" layout="pageDirection">
            <f:selectItems value="#{columnContext.columnsSelectItems}"/>
        </h:selectManyCheckbox>
        <hr/>
        <p:commandButton value="Update" onclick="columnsDialog.hide()" update="resultsTable"/>
    </p:dialog>

    <p:dataTable id="resultsTable" var="binaryInteraction" value="#{searchBean.results}"
                     rows="#{userQuery.pageSize}"
                     dynamic="true" lazy="true"
                     paginator="#{searchBean.results.rowCount gt userQuery.pageSize}">
        <p:column>
                <h:panelGroup rendered="#{not testController.results.sameThanPrevious}">
                    <h:commandLink action="details">
                        <f:setPropertyActionListener value="#{testController.getIntactAc(binaryInteraction)}"
                                                     target="#{detailsBean.interactionAc}"/>
                        <h:graphicImage url="/images/magnify.png" alt="" />
                    </h:commandLink>
                </h:panelGroup>
            </p:column>

            <p:column rendered="#{columnContext.isColumnVisible('moleculeA.name')}">
                <f:facet name="header">
                    <h:outputText value="#{messages['moleculeA.name']}"/>
                </f:facet>
                <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">
                    <h:outputText value="#{iamf:getInteractorDisplayName(binaryInteraction.interactorA)}"/>
                </h:panelGroup>

                    <iv:moleculeBoxes interactor="#{binaryInteraction.interactorA}"/>
            </p:column>

            <p:column rendered="#{columnContext.isColumnVisible('moleculeA.links')}">
                <f:facet name="header">
                    <h:outputText value="#{messages['moleculeA.links']}"/>
                </f:facet>
                <iv:interactorLinkLogos interactor="#{binaryInteraction.interactorA}"
                        display="#{not searchBean.results.sameThanPrevious}"/>
            </p:column>

            <p:column rendered="#{columnContext.isColumnVisible('moleculeB.name')}">
                <f:facet name="header">
                    <h:outputText value="#{messages['moleculeB.name']}"/>
                </f:facet>
                <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">

                    <h:outputText value="#{iamf:getInteractorDisplayName(binaryInteraction.interactorB)}"/>

                    <!--For MoleculeType, Role Initials -->

                </h:panelGroup>

                <iv:moleculeBoxes interactor="#{binaryInteraction.interactorB}"/>
            </p:column>

            <p:column styleClass="cellTextCompound"
                      rendered="#{columnContext.isColumnVisible('moleculeB.links')}">
                <f:facet name="header">
                    <h:outputText value="#{messages['moleculeB.links']}"/>
                </f:facet>
                <iv:interactorLinkLogos interactor="#{binaryInteraction.interactorB}"
                        display="#{not searchBean.results.sameThanPrevious}"/>
            </p:column>

        <p:column styleClass="cellTextCompound"
                  rendered="#{columnContext.isColumnVisible('moleculeA.aliases')}">
            <f:facet name="header"><h:outputText value="#{messages['moleculeA.aliases']}"/></f:facet>

            <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">
                <iam:collapsibleIterator disclosed="#{searchBean.showAlternativeIds}"
                                         value="#{iamf:getExclusionFilteredCrossReferences(binaryInteraction.interactorA.alternativeIdentifiers,null,'rogid')}"
                                         maxShown="3">
                    <h:outputText value="#{item.identifier}" style="white-space:nowrap;"/>
                </iam:collapsibleIterator>
            </h:panelGroup>
        </p:column>

        <p:column styleClass="cellTextCompound"
                  rendered="#{columnContext.isColumnVisible('moleculeB.aliases')}">
            <f:facet name="header"><h:outputText value="#{messages['moleculeB.aliases']}"/></f:facet>

            <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">
                <iam:collapsibleIterator disclosed="#{searchBean.showAlternativeIds}"
                                         value="#{iamf:getExclusionFilteredCrossReferences(binaryInteraction.interactorB.alternativeIdentifiers,null,'rogid')}"
                                         maxShown="3">
                    <h:outputText value="#{item.identifier}" style="white-space:nowrap;"/>
                </iam:collapsibleIterator>
            </h:panelGroup>
        </p:column>

        <p:column styleClass="cellTextCompound"
                  rendered="#{columnContext.isColumnVisible('moleculeA.species')}">
            <f:facet name="header"><h:outputText value="#{messages['moleculeA.species']}"/></f:facet>

            <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">
                <h:panelGroup rendered="#{binaryInteraction.interactorA.interactorType.identifier != 'MI:0328'}">
                    <ui:include src="/pages/interactions/organism.xhtml">
                        <ui:param name="organism" value="#{binaryInteraction.interactorA.organism}"/>
                    </ui:include>
                </h:panelGroup>
                <h:panelGroup rendered="#{binaryInteraction.interactorA.interactorType.identifier == 'MI:0328'}">
                    N/A
                </h:panelGroup>
            </h:panelGroup>
        </p:column>

        <p:column styleClass="cellTextCompound"
                  rendered="#{columnContext.isColumnVisible('moleculeB.species')}">
            <f:facet name="header"><h:outputText value="#{messages['moleculeB.species']}"/></f:facet>

            <h:panelGroup rendered="#{not searchBean.results.sameThanPrevious}">
                <h:panelGroup rendered="#{binaryInteraction.interactorB.interactorType.identifier != 'MI:0328'}">
                    <ui:include src="/pages/interactions/organism.xhtml">
                        <ui:param name="organism" value="#{binaryInteraction.interactorB.organism}"/>
                    </ui:include>
                </h:panelGroup>
                <h:panelGroup rendered="#{binaryInteraction.interactorB.interactorType.identifier == 'MI:0328'}">
                    N/A
                </h:panelGroup>
            </h:panelGroup>
        </p:column>

        <p:column rendered="#{columnContext.isColumnVisible('interaction.firstauthor')}"
                  styleClass="cellTextInteraction">
            <f:facet name="header"><h:outputText value="#{messages['interaction.firstauthor']}"/></f:facet>

            <ui:repeat var="author" value="#{binaryInteraction.authors}">
            <span style="display:block">
                    <h:outputText value="#{author.name}" style="white-space:nowrap;"/>
            </span>
            </ui:repeat>
        </p:column>

        <p:column  rendered="#{columnContext.isColumnVisible('interaction.pubmedid')}"
                   styleClass="cellTextInteraction">
            <f:facet name="header"><h:outputText value="#{messages['interaction.pubmedid']}"/></f:facet>
            <iav:xrefDataList value="#{binaryInteraction.publications}" itemPerLine="true"/>
        </p:column>

        <p:column rendered="#{columnContext.isColumnVisible('interaction.interactiontype')}"
                  styleClass="cellTextInteraction">
            <f:facet name="header"><h:outputText value="#{messages['interaction.interactiontype']}"/></f:facet>
            <iav:xrefDataList value="#{binaryInteraction.interactionTypes}" onlyText="true" itemPerLine="true"/>
        </p:column>

        <p:column rendered="#{columnContext.isColumnVisible('interaction.detectionmethod')}"
                  styleClass="cellTextInteraction">
            <f:facet name="header"><h:outputText value="#{messages['interaction.detectionmethod']}"/></f:facet>
            [Not Implemented]
            <!--<ui:include src="xrefCvPopupDialog.xhtml">-->
                <!--<ui:param name="xref" value="${binaryInteraction.detectionMethods[0]}"/>-->
            <!--</ui:include>-->
        </p:column>

        <p:column rendered="#{columnContext.isColumnVisible('interaction.sourcedb')}"
                  styleClass="cellTextInteraction">
            <f:facet name="header"><h:outputText value="#{messages['interaction.sourcedb']}"/></f:facet>
            <iav:xrefDataList value="#{binaryInteraction.sourceDatabases}" itemPerLine="true" onlyText="true"/>
        </p:column>

        <p:column rendered="#{columnContext.isColumnVisible('interaction.ac')}">
            <f:facet name="header">
                    <h:outputText value="#{messages['interaction.ac']}"/>
                </f:facet>

                <ui:repeat var="xref" value="#{binaryInteraction.interactionAcs}"
                           varStatus="rowStatus" rows="0">
                    <h:panelGroup rendered="#{xref.database == 'intact'}">
                        <h:panelGroup>
                            <h:commandLink action="details" value="#{xref.identifier}">
                                <f:setPropertyActionListener value="#{xref.identifier}" target="#{detailsBean.interactionAc}"/>
                            </h:commandLink>
                            <br/>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{xref.database != 'intact' and xref.database != 'irefindex'}">
                        <h:outputText value="#{iav:xrefToString(xref, true, true, false)}" style="white-space: pre;"/>
                        <br/>
                    </h:panelGroup>
                </ui:repeat>
            </p:column>



        </p:dataTable>

</ui:composition>