<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:trh="http://myfaces.apache.org/trinidad/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:ebisf="http://www.ebi.ac.uk/faces/site"
                xmlns:ebi="http://ebi.ac.uk/faces/components"
                xmlns:iav="http://intact.ebi.ac.uk/view"
                xmlns:iaf="http://intact.ebi.ac.uk/functions"
                xmlns:iax="http://intact.ebi.ac.uk/extlinks"
                xmlns:iam="http://intact.ebi.ac.uk/mitabfunctions"

                template="/main.xhtml">
    
    <ui:param name="disclosedTabName" value="browse"/>

    <ui:define name="browseTabContent">

        <tr:commandLink text="&lt; Back to Browse options" action="browse"/>

        <tr:panelHeader text="Gene Ontology Browser">

            <tr:panelGroupLayout>
                <f:facet name="separator">
                    <tr:spacer height="5"/>
                </f:facet>

            <!-- RESULT SUMMARY -->

            <tr:panelGroupLayout layout="vertical" id="searchSummary">

                <tr:group>
                    Displaying results for query:
                    <strong><ebi:outputText id="queryText" value="#{searchBean.userQuery.displayQuery}" maxLength="50"
                                    expandMessage="(see entire query)" collapseMessage="(collapse)"/></strong>
                </tr:group>

            </tr:panelGroupLayout>

            <!-- GO Browser -->

            <tr:panelHorizontalLayout>
                <f:facet name="separator">
                    <tr:spacer width="50px"/>
                </f:facet>

                <tr:treeTable var="otw" value="#{goBrowser.goOntologyTreeModel}" rootNodeRendered="false" >

                    <f:facet name="nodeStamp">
                        <tr:column>
                            <f:facet name="header">
                                <tr:outputText value="GO Name"/>
                            </f:facet>
                            <tr:outputText value="#{otw.term.name}"/>
                        </tr:column>

                        <c:set var="countedOtw" value="${iam:populateCounts(otw, indexRequestController.defaultInteractorIndex, indexRequestController.defaultInteractionIndex)}"/>

                    </f:facet>
                    <tr:column>
                        <f:facet name="header">
                            <tr:outputText value="GO ID"/>
                        </f:facet>
                        <tr:outputText value="#{otw.term.id}"/>
                    </tr:column>
                    <tr:column>
                        <f:facet name="header">
                            <tr:outputText value="# Proteins"/>
                        </f:facet>
                        <tr:group>
                           <tr:outputText value="#{countedOtw.interactorCount}"/>
                            &#160;
                            <tr:commandLink text="View" rendered="#{countedOtw.interactorCount > 0}"
                                            actionListener="#{searchBean.doFilteredBinarySearch}"
                                            action="list.proteins">
                                <f:param name="query" value="#{searchBean.userQuery.searchQuery}" />
                                <f:param name="termId" value="#{otw.term.id}" />
                                <!--<f:setPropertyActionListener value="#{otw.term.id}" target="#{searchBean.filter}"/>-->
                                <!--<f:setPropertyActionListener value="#{otw.baseQuery}" target="#{searchBean.userQuery.searchQuery}"/>-->
                            </tr:commandLink>
                        </tr:group>
                    </tr:column>
                    <tr:column>
                        <f:facet name="header">
                            <tr:outputText value="# Interactions"/>
                        </f:facet>
                        <tr:group>
                           <tr:outputText value="#{otw.interactionCount}"/>
                            &#160;
                             <tr:commandLink text="View" rendered="#{countedOtw.interactorCount > 0}"
                                             actionListener="#{searchBean.doFilteredBinarySearch}"
                                             action="interactions">
                                 <f:param name="query" value="#{searchBean.userQuery.searchQuery}" />
                                 <f:param name="termId" value="#{otw.term.id}" />
                                 <!--<f:setPropertyActionListener value="#{otw.term.id}" target="#{searchBean.filter}"/>-->
                                 <!--<f:setPropertyActionListener value="#{otw.baseQuery}" target="#{searchBean.userQuery.searchQuery}"/>-->
                            </tr:commandLink>
                        </tr:group>
                    </tr:column>
      
                </tr:treeTable>

            </tr:panelHorizontalLayout>

            </tr:panelGroupLayout>

        </tr:panelHeader>

    </ui:define>

</ui:composition>