<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:trh="http://myfaces.apache.org/trinidad/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <tr:panelBox inlineStyle="width:100%" partialTriggers="addFieldBtn cancelFieldBtn">
        
        <div style="float:right">
            <tr:commandLink text="MIQL syntax reference"
                            action="dialog:help.miql" partialSubmit="true"
                            windowWidth="600" windowHeight="600" immediate="true"
                            useWindow="true"/>
        </div>
        
        <tr:panelHorizontalLayout valign="top">
            <f:facet name="separator">
                &#160;
            </f:facet>

            <trh:script>
                dojo.addOnLoad(function () {
                   document.getElementById('queryTxt').focus();
                });
            </trh:script>

            <tr:inputText label="Search: " id="queryTxt"
                          columns="60" value="#{userQuery.searchQuery}"
                          rows="#{(fn:length(userQuery.searchQuery) / 60) + 1}"
                          onkeypress="return submitEnter('quickSearchBtn',event)"
                          disabled="#{userQuery.showNewFieldPanel}"/>
            <tr:commandButton id="quickSearchBtn"
                              text="Search"
                              action="#{searchBean.doNewBinarySearch}"
                              disabled="#{userQuery.showNewFieldPanel}"/>
            <tr:commandButton text="Clear"
                              onclick="queryTxt = document.getElementById('queryTxt'); queryTxt.value = ''; queryTxt.focus()"
                              disabled="#{userQuery.showNewFieldPanel}"/>

            <tr:commandLink id="addFieldBtn" text="Fields Â»"
                            inlineStyle="font-weight:bold"
                    actionListener="#{userQuery.doShowAddFieldPanel}"
                    disabled="#{userQuery.showNewFieldPanel}"
                    partialSubmit="true"/>

        </tr:panelHorizontalLayout>

         </tr:panelBox>



    <tr:panelGroupLayout partialTriggers="addFieldBtn cancelFieldBtn">
        <tr:panelBox inlineStyle="width:100%" rendered="#{userQuery.showNewFieldPanel}">

                <tr:panelHorizontalLayout>
                    <f:facet name="separator">
                        &#160;
                    </f:facet>

                    <tr:selectOneChoice value="#{userQuery.newQueryToken.operandStr}"
                            disabled="#{userQuery.wildcardQuery}">
                        <f:selectItem itemValue="AND" itemLabel="AND"/>
                        <f:selectItem itemValue="OR" itemLabel="OR" itemDisabled="#{empty userQuery.searchQuery or
                                                                                    userQuery.searchQuery eq '*:*'}"/>
                    </tr:selectOneChoice>

                    <tr:selectBooleanCheckbox text="NOT" value="#{userQuery.newQueryToken.notQuery}"/>

                    <tr:selectOneChoice id="newQueryField" label="Field: " value="#{userQuery.newQueryToken.field}"
                                        autoSubmit="true" immediate="true">
                        <f:selectItems value="#{userQuery.searchFieldSelectItems}"/>
                    </tr:selectOneChoice>

                    <tr:panelGroupLayout partialTriggers="newQueryField">
                        <tr:inputText value="#{userQuery.newQueryToken.query}" columns="50"
                                      rendered="#{not userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteCapable}"/>

                        <tr:selectOneChoice value="#{userQuery.newQueryToken.query}" unselectedLabel="-- Select one --"
                                rendered="#{userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteCapable}">
                            <f:selectItems value="#{userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteMethod}"/>
                        </tr:selectOneChoice>
                    </tr:panelGroupLayout>

                    <tr:commandButton text="Add &amp; Search"
                                      actionListener="#{userQuery.doAddFieldToQuery}"
                                      action="#{searchBean.doNewBinarySearch}"/>

                    <tr:commandButton id="cancelFieldBtn" text="Cancel"
                                      actionListener="#{userQuery.doCancelAddField}" partialSubmit="true"/>

                </tr:panelHorizontalLayout>
        </tr:panelBox>
    </tr:panelGroupLayout>

    <tr:separator/>

</ui:composition>